version: 0.0

phases:
  build:
    commands:
      - echo This is craig2spec.yml.
      - yum install git -y
      - git clone https://github.com/craigwongva/microqoder
      - cd microqoder
      - /usr/local/share/grails-2.4.0/bin/grails war
      - mkdir -p build-output
      - cp target/Qoder-0.1.war build-output/
      - cp appspec.yml build-output/
      - cd build-output
      - zip -qr build-output.zip ./*
      - mv build-output.zip ../

artifacts:
  files:
    - build-output.zip
#    - microqoder/target/Qoder-0.1.war
#    #    - microqoder/appspec.yml
#
#    #  discard-paths: yes    
#
#    # Zip technique borrowed from 
#    #   https://stackoverflow.com/questions/44853819/issue-creating-zip-file-through-aws-codebuild-for-nodejs-lambda
#    #
#    #  post_build:
#    #    commands:
#    #      - echo Running post_build commands
#    #      - mkdir build-output
#    #      - cp -R folder1/myfile.js build-output
#    #      - mkdir -p build-output/node_modules
#    #      - cp -R node_modules/* build-output/node_modules
#    #      - cd build-output/
#    #      - zip -qr build-output.zip ./*
#    #      - mv build-output.zip ../
#    #      - echo Build completed on `date`
#    #artifacts:
#    #  files:
#    #    - build-output.zip
